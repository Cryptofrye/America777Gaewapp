function SlotMachine(e){function Z(e,t){var n=r.getCachedImg("fgSymbolSmall"+e.bonusSymbol),o=$(".headlineContainer, .portraitHeadlineContainer"),a=$(".mainControlBoxBG"),l=$(".freegame_blending");o.append('<div class="fgBonusSymbol"><img src="'+n.src+'" alt="" /></div>'),f.sendRequest("getFGPayTable",{bonus:e.bonusSymbol});var c=$("#freegame_container");$("._wlid_darkening").css("opacity",1),H&&d==1280?setTimeout(function(){u.addStartHypeListener("amfreegame",function(){c.hide().removeClass("intro").html(""),o.removeClass("plain"),$("._wlid_darkening").css("opacity",0),t()});var n={1:"Sym_LV5",2:"Sym_LV4",3:"Sym_LV3",4:"Sym_LV2",5:"Sym_LV1",6:"Sym_HV3",7:"Sym_HV2",8:"Sym_HV1",9:"Sym_TOP"};o.addClass("plain"),i.start(n[e.bonusSymbol],"amfreegame")},300):setTimeout(function(){c.removeClass("intro"),c.html('<div id="symbolBGLayer" class="hidden"></div><div class="hidden" id="symbolPictLayer"></div>'),$("#symbolBGLayer").fadeIn("fast","linear");var t=$("#symbolPictLayer"),n=r.getCachedImg("optSlotSymbolSelection_bg");t.css({"background-image":"url("+n.src+")"}),s.play({soundLine:"fg1",playwhat:"choiceResult"}),o.addClass("title"),t.fadeIn(function(){t.append('<div class="hidden" id="chosenBonusSymbol"></div>');var i=$("#chosenBonusSymbol");n=r.getCachedImg(Q[e.bonusSymbol]),i.css({"background-image":"url("+n.src+")","background-size":"contain"}),i.fadeIn(2500,function(){setTimeout(function(){t.remove(),i.remove(),c.hide().removeClass("intro").html(""),o.removeClass("title plain"),l.removeClass("pixi"),$("._wlid_darkening").css("opacity",0),e.startFreegame()},600)})})},400)}function et(e,t){_&&(e=Date.now()-_);var n=0,r=300,i=700;e%=1e3,e<r?n=e/r:e>i?n=(1e3-e)/r:n=1;var s={};for(var o in t)s[t[o]]=n;return s}function tt(){if(j)return!1;for(var e in I){F[e]||(F[e]=Date.now());var t=Date.now(),n=t-F[e];nt(n,e)}return!0}function nt(e,t){var n=250,r=100,i=200,s=n+r+i,o=0;e>=0&&e<=n?o=e/n:e>n&&e<=n+r?o=1:e>n+r&&e<=s?o=(s-e)/i:o=0,I[t].css({opacity:o})}function rt(e,t,n,i){q||($("._wlid_winsymbols").after('<div id="symbolAnimBGLayer"></div>'),q=$("#symbolAnimBGLayer"));var s="bgSymbol_"+n;q.append('<div class="bgSymbol" id="'+s+'"></div>');var o=$("#"+s);typeof i=="string"&&(i=r.getCachedImg(i)),o.css({left:e,top:t,"background-image":"url("+i.src+")"})}function it(){ut(),P=!0,R&&(R.remove(),R=null),q&&(q.remove(),q=null)}function st(e){i=new HypeManager({}),c=e?new PixiManager({animManager:l}):null,$("#loading .progress").html("100%"),$("#loading .state").show(),obj_restHandler.requestInit()}function ot(){if(P)return _=!1,D=!1,!1;_||(_=Date.now());var e=Date.now(),t=(e-_)%1e3,n=0;t<300?n=t/300:t>700?n=(1e3-t)/300:n=1;for(var r in D)D[r].css({opacity:n});return!0}function ut(){for(var e in z){var t=z[e];a.setSymbol(t[0],t[1])}z=[]}function at(e){obj_restHandler.processResponse(e);if(typeof e.initData!="undefined"){typeof e.initData.reeltiming=="string"&&(g=e.initData.reeltiming),obj_restHandler.onSoundLoaded(e.initData.sound),o=new WinLines({cache:r,devConf:t,slotConf:n,animManager:l,bigSymbol:["/scatter_small.png"]}),u=new FreeGame({conf:n,devConf:t,sound:s,hype:i,getReelIdx:o.getReelIdx,scatter:10,animBG:"scatterBonus",animFG:"scatterBonus",startPauseCallback:Z,useOptimalAnim:!0,spinAfterIntro:function(){obj_console.clickButton("spin",{noSound:!0})},animManager:l,pixiManager:c,lang:A,plainForPortrait:!0}),a=new ReelEngine({sound:s,cache:r,conf:t,animManager:l,finishListener:!0,container:"reel_hype_container",size:{w:n.size("sW"),h:n.size("sH")},reelSpace:n.size("sp"),scatter:["/symbol-scatter.png","/symbol-m-scatter.png"],scatterParams:{h:n.size("scH")+"px",m:n.size("scO")+"px"},speed:n.speed(g),bounce:[[0,-0.2515],[.033333333,.0485],[.066666667,.2235],[.1,.258],[.133333333,.178],[.166666667,.1],[.2,.0447],[.233333333,.0113],[.266666667,0]],rows:n.rows(),symbols:["/symbol-lv5.jpg","/symbol-lv4.jpg","/symbol-lv3.jpg","/symbol-lv2.jpg","/symbol-lv1.jpg","/symbol-hv3.jpg","/symbol-hv2.jpg","/symbol-hv1.jpg","/symbol-top.jpg","/symbol-scatter.png","/symbol-s-lv5.jpg","/symbol-s-lv4.jpg","/symbol-s-lv3.jpg","/symbol-s-lv2.jpg","/symbol-s-lv1.jpg","/symbol-s-hv3.jpg","/symbol-s-hv2.jpg","/symbol-s-hv1.jpg","/symbol-s-top.jpg","/symbol-m-lv5.jpg","/symbol-m-lv4.jpg","/symbol-m-lv3.jpg","/symbol-m-lv2.jpg","/symbol-m-lv1.jpg","/symbol-m-hv3.jpg","/symbol-m-hv2.jpg","/symbol-m-hv1.jpg","/symbol-m-top.jpg","/symbol-m-scatter.png","/symbol-fg-lv5.jpg","/symbol-fg-lv4.jpg","/symbol-fg-lv3.jpg","/symbol-fg-lv2.jpg","/symbol-fg-lv1.jpg","/symbol-fg-hv3.jpg","/symbol-fg-hv2.jpg","/symbol-fg-hv1.jpg","/symbol-fg-top.jpg"],fakeReels:G,fakeReelSymbols:K,fakeCriticalSymbols:Y}),a.init(),obj_anim=new SlotMachineAnim({hype:i,sound:s,cache:r,conf:n,devConf:t,winLines:o,reelEngine:a,animManager:l,freeGame:u,linepings:!0,stamping:!0,scatterForFreeGames:10,symbolTeaserAnim:!0,symbolTeaserAnimDuration:1005,playFreegameIntro:!1,animations:v,noAttSpinAnim:!1,winanim:p,optimalSlotAnimations:B,optimalSlotBigAnimData:{scatterBonus:{h:n.size("scH")+(d=="640"?17:34)+"px",o:n.size("scO")-(d=="640"?17:34)+"px"},wild:{h:n.size("scH")+(d=="640"?17:34)+"px",o:n.size("scO")-(d=="640"?17:33)+"px"}},soundSet:b,restartAttentionSpinSound:!0,symbols:K,useStampAnimsForOptSlot:!0,stampAnims:{1:"feature1",2:"feature2",3:"feature3",4:"feature4",5:"feature5",6:"feature6",7:"feature7",8:"feature8",9:"feature9"},ownFunctions:{asas:it,bwa:function(e){W=e,e.callback()},ofge:function(e){var t=r.getCachedImg("fgSymbolSmall"+e);$(".headlineContainer").append('<div class="fgBonusSymbol"><img src="'+t.src+'" alt="" /></div>'),f.sendRequest("getFGPayTable",{bonus:e})},awa:function(e){U&&(e.animHandler.stop(U),U=!1)},bss:function(){j=!0,F=[],I=[],$("#symbolTeaserContainer").html("")},rss:function(e){var i=e.actReel,u=e.playAnim,a=y?"reelstop":"reelstop"+(i+1),f=e.symbolTeaserPos;if(f[i]){var c=f[i][0],h=1;for(var p=0;p<i;++p)f[p]&&f[p][0]==c&&++h;s.play({playwhat:"symbolTeaser"+c+"x"+h,soundLine:h==1?"fg2":"fg1"});if(t.playSymbolAnims())u("symbolTeaser"+c,[{x:n.size("sWs")*i,y:n.size("sH")*(f[i][1]-1),elem:"#reel_"+o.getReelIdx(i)+"_"+(n.rows()+1-f[i][1])}],{loop:!1});else{$("#symbolTeaserContainer").length||$("._wlid_animBox").before('<div id="symbolTeaserContainer"></div>');var v=$("#symbolTeaserContainer"),m=$('<div class="teaserSymbol"</div>');v.append(m);var g=r.getCachedImg("symbolTeaser10Glow");I.push(m);var b=n.size("sWs")*i-1,w=n.size("sH")*(f[i][1]-1)+n.size("scO");m.css({left:b,top:w-(d=="640"?17:34),height:n.size("scH")+(d=="640"?17:34),"background-image":"url("+g.src+")",opacity:0}),j=!1,F[0]||l.add("symbolTeaser10",tt)}e.setTeaserPlaying(c)}else s.play({playwhat:a,soundLine:"fg1"})},gbp:function(e){if(e.winLine){var t={},n=o.getPosition(e.winLine,e.reel)+1;if(e.frp[n-1]==10)return e.frp[n+1]==10?(t[e.reel+1]=r.getCachedImg("scatterBlendTopBottom"),t):(t[e.reel+1]=r.getCachedImg("scatterBlendTop"),t);if(e.frp[n+1]==10)return t[e.reel+1]=r.getCachedImg("scatterBlendBottom"),t}return!1}}}),obj_restHandler.enableManualReels({halfsize:t.mode("r"),rows:n.rows(),reelSymbols:K,anim:obj_anim,reelEngine:a}),obj_console=new OnlineConsole({devConf:t,sound:s,animManager:l,onMoneySet:obj_restHandler.onMoneySet,spacebarActivated:e.initData.spaceBar,quickSpin:e.initData.quickSpin,leftHandMode:e.initData.leftHandMode,featureCountdown:e.initData.featureCountdown,requestSender:f.sendRequest,featureCountdownType:"freegame",bottomNotClickable:!t.isBottomAreaClickable(),alwaysShowVersionAndSlotname:N,numInputTypeForMobile:t.getNumericInputTypeForMobile()}),obj_slotmachineController=new SlotmachineController({requestSender:f.sendRequest,console:obj_console,anim:obj_anim,sound:s,loader:r,devConf:t,animManager:l,pixiManager:c,restHandler:obj_restHandler,layout169:m,hasPauseInFreegameIntro:!0,requestFGBonusSymbol:!0,rulesURL:w,rulesJSLoader:E,loadRulesInClient:S,onPending:x,reeltiming:g,startFullScreen:X,stopFullScreen:V,enabledFullScreen:J,hasBetChangeLoops:C,startGameRound:O,finishGameRound:M,useFakeReels:!0}),obj_restHandler.addCallbacks({deactivateAutoSpin:obj_console.stopAutospin,setLineBets:function(e){obj_slotmachineController.display([{type:"possLinebets",value:e}])},abortWinAnim:function(){obj_console.clickButton("abortwinanim")},getState:obj_console.getState,pauseSlot:obj_slotmachineController.pauseSlot,resumeSlot:obj_slotmachineController.resumeSlot,afterFreeRoundsIntro:obj_slotmachineController.onFreeRoundsIntroClose,ignoreUserInput:obj_console.ignoreUserInput});var k=H&&d==1280?1:0;t.useCoinShowers()&&k++;var L=function(){obj_slotmachineController.init(e.initData),o.onInitialized({attention:e.initData.attentionSpin}),obj_restHandler.onSMReady(),T&&T()},_=function(){c.load({name:"GenericSign",divID:"pixi_container",callback:L})};k?(i.addListener({type:i.onDocumentLoaded,callback:function(){h++,h==k&&(_(),i.onInitialized())}}),t.useCoinShowers()&&i.load({name:p}),H&&d==1280&&i.load({name:"amfreegame"})):_()}typeof e.display!="undefined"&&obj_slotmachineController&&obj_slotmachineController.display(e.display);if(typeof e.fgPayTable!="undefined"&&e.fgPayTable){$(".headlineContainer").append(e.fgPayTable);var D=t.mode("r")==0?2:1,P=$(".fgPayTable").width(),q=.73*P,R=1,z=D*8.5,Q=1.25*z;$(".fgPayTable .fgWinValue").each(function(){var e=$(this),t=e.attr("id"),n=t.split("-")[1],r=$.trim(e.text());e.html("");var i=Raphael(t,P,Q),s={"text-anchor":"start","font-size":z};ft(i.text("3%","80%",obj_lang["game_paytable_mult"+n]).attr(s),D,"#D3B63D","#FCE700");var o={"text-anchor":"end","font-family":'"Noto Sans", Arial, Sans-serif',"font-size":R*z,"font-weight":"bold",fill:"white"},u=i.text("100%","81%",r).attr(o),a=u.getBBox().width;if(a>q){var f=q/a;f<R&&(R=f),u.attr("font-size",R*z)}})}}function ft(e,t,n,r){var i={"font-family":'"Noto Sans", Arial, Sans-serif',"font-weight":"bold",fill:n};e.attr(i).stroke({color:"#000000",opacity:1,width:t})}function lt(e,t){var n={"font-family":'"Noto Sans", Arial, Sans-serif',"font-weight":"bold",fill:"#D6A031"};e.attr(n).stroke({color:"#000000",opacity:.5,width:t})}var t,n,r,i,s,o,u,a,f,l,c,h=0,p="winanim",d=!1,v=null,m=!1,g="normal",y=!1,b=3,w=!1,E=null,S=!1,x=null,T=null,N=!1,C=!0,k=!1,L=!1,A="en",O=null,M=null,_=!1,D=null,P=!1,H=!0,B=["wild","scatterBonus","symbolTeaser10","feature1","feature2","feature3","feature4","feature5","feature6","feature7","feature8","feature9","feature10"],j=!0,F=[],I=[],q=null,R=null,U=!1,z=[],W=null,X=null,V=null,J=null,K={base:{1:"/symbol-lv5.jpg",2:"/symbol-lv4.jpg",3:"/symbol-lv3.jpg",4:"/symbol-lv2.jpg",5:"/symbol-lv1.jpg",6:"/symbol-hv3.jpg",7:"/symbol-hv2.jpg",8:"/symbol-hv1.jpg",9:"/symbol-top.jpg",10:"/symbol-scatter.png",winLines:{10:"/scatter_small.png"}},free:{1:"/symbol-fg-lv5.jpg",2:"/symbol-fg-lv4.jpg",3:"/symbol-fg-lv3.jpg",4:"/symbol-fg-lv2.jpg",5:"/symbol-fg-lv1.jpg",6:"/symbol-fg-hv3.jpg",7:"/symbol-fg-hv2.jpg",8:"/symbol-fg-hv1.jpg",9:"/symbol-top.jpg",10:"/symbol-scatter.png",winLines:{10:"/scatter_small.png"}},bonus:{1:"/symbol-s-lv5.jpg",2:"/symbol-s-lv4.jpg",3:"/symbol-s-lv3.jpg",4:"/symbol-s-lv2.jpg",5:"/symbol-s-lv1.jpg",6:"/symbol-s-hv3.jpg",7:"/symbol-s-hv2.jpg",8:"/symbol-s-hv1.jpg",9:"/symbol-s-top.jpg"},monochrome:{1:"/symbol-m-lv5.jpg",2:"/symbol-m-lv4.jpg",3:"/symbol-m-lv3.jpg",4:"/symbol-m-lv2.jpg",5:"/symbol-m-lv1.jpg",6:"/symbol-m-hv3.jpg",7:"/symbol-m-hv2.jpg",8:"/symbol-m-hv1.jpg",9:"/symbol-m-top.jpg",10:"/symbol-m-scatter.png"}},Q={1:"AM_Feature_Sym_10",2:"AM_Feature_Sym_J",3:"AM_Feature_Sym_Q",4:"AM_Feature_Sym_K",5:"AM_Feature_Sym_A",6:"AM_Feature_Sym_Candles",7:"AM_Feature_Sym_Poison",8:"AM_Feature_Sym_Crow",9:"AM_Feature_Sym_Witch"},G={base:{a:[6,3,4,7,2,5,7,4,5,2,3,6,4,3,7,2,5,3,1,10,5,2,3,4,1,5,9,3,4,2,5,7,3,4,5,9,4,5,8,1,4,7,3,1,8,4,3,7,5,2],b:[5,2,4,1,2,4,1,3,5,4,6,1,2,7,4,1,6,3,1,2,4,1,2,6,1,2,4,8,1,4,9,3,2,8,5,2,4,6,2,3,10,5,1,2,4],c:[2,5,10,1,2,3,1,2,6,5,3,2,1,7,4,5,2,1,7,4,5,1,8,5,1,4,8,5,3,7,5,3,8,2,1,9,2,1,8,5,3,6,1,3,9,2,1,3,6],d:[1,4,7,3,5,4,2,8,5,3,2,10,1,4,9,5,3,6,1,7,4,3,9,1,3,7,1,5,7,1,5,8,3,2,5,4,6,3,8,4,6,1,2,3,7,2,4,10,3,5],e:[2,8,3,7,5,1,10,3,2,7,3,8,2,9,3,1,4,2,10,4,2,8,5,1,7,3,5,7,4,1,2,10,4,2,7,3,6,1,5,6,4,2,9,5,4,6,5,1,6,4,7,3,6,1,5,6,4,2,9,5,4,6,5,1,6,4,1,2,10,4,2,8,5,4,7,3,5,7,3,4,8,3,7,5,1,10,3,2,7,3,8,2,9,3,1]},free:{a:[7,1,4,8,3,1,10,4,2,8,4,5,2,3,6,2,3,7,4,5,2,9,3,4,5,6,3,5,2,9,4,5,2,8,1,10,5],b:[6,2,10,4,3,7,4,5,1,6,2,1,3,2,1,8,2,5,3,1,2,3,10,5,1,3,5,4,6,1,3,9,2,5,4,7,5],c:[2,5,9,3,1,10,4,2,8,4,3,2,5,3,9,1,3,4,2,8,1,5,7,4,5,1,2,4,6,2,5,9,1,4,3,7],d:[3,6,4,8,3,1,10,4,1,7,4,3,6,5,1,4,7,3,2,9,5,3,6,4,1,6,2,1,9,2,5,7,3,2,10,1,4],e:[7,4,9,5,7,3,8,5,7,2,5,9,2,1,8,2,1,9,3,6,1,2,10,4,1,8,3,6,5,10,4,6,1,8,4,7,3]}},Y=[9,10];this.onShutdown=function(){obj_restHandler.onCloseGame()},function(e){d=e.resolution,v=e.animationData,m=e.layout169,w=e.rulesURL,E=e.rulesJSLoader,typeof e.loadRulesInClient!="undefined"&&(S=e.loadRulesInClient),typeof e.onPending=="function"&&(x=e.onPending),typeof e.onLoaded=="function"&&(T=e.onLoaded),typeof e.lang!="undefined"&&(A=e.lang),typeof e.enforceVersion!="undefined"&&(N=e.enforceVersion),typeof e.hasBetChangeLoops!="undefined"&&(C=e.hasBetChangeLoops),typeof e.showExtraJackpotBet!="undefined"&&(k=e.showExtraJackpotBet),typeof e.showInfoDuringJackpotChance!="undefined"&&(L=e.showInfoDuringJackpotChance),typeof e.startGameRound=="function"&&(O=e.startGameRound),typeof e.finishGameRound=="function"&&(M=e.finishGameRound),typeof e.startFullScreen=="function"&&(X=e.startFullScreen),typeof e.stopFullScreen=="function"&&(V=e.stopFullScreen),typeof e.enabledFullScreen=="function"&&(J=e.enabledFullScreen),t=new DeviceConfig({mode:e.mode}),typeof e.supressAutoFullscreen!="undefined"&&e.supressAutoFullscreen&&t.supressAutoFullscreenDetection(),n=new SlotConfig({devConfig:t,machine:"ancientmagic"}),p=e.winanim+(t.useCoinShowers()==="optimal"?"opt":""),y=t.useSmallSounds(),typeof e.reeltiming!="undefined"&&(g=e.reeltiming),H=t.playSymbolAnims(),l=new AnimManager,f=new Communicator({slotmachine:"AncientMagic",responseHandler:at,slotConf:n,lablerEventManager:typeof e.lablerEventManager!="undefined"?e.lablerEventManager:!1}),obj_restHandler=new SMRestHandler({requestSender:f.sendRequest,isSoundSettable:e.isSoundSettable,clock:typeof e.showClock=="undefined"?!1:e.showClock,version:typeof e.showVersion=="undefined"?!1:e.showVersion,name:"ANCIENT MAGIC",warnBrowser:t.showBrowserWarning(),onFatalError:typeof e.onFatalError=="undefined"?!1:e.onFatalError,lablerEventManager:typeof e.lablerEventManager!="undefined"?e.lablerEventManager:!1}),r=new GameLoader({height:n.size("h"),width:n.size("w"),devConf:t,restHandler:obj_restHandler,baseURL:typeof e.baseURL=="undefined"?"":e.baseURL}),obj_restHandler.isResizable()&&r.autofit();var i=obj_restHandler.getSoundFiles(e.soundFiles,y),o=0;for(var u in i)++o;var a=typeof e.winLines!="undefined"&&e.winLines?e.winLines:5;r.preload({pictures:getPreloadImages(t,n,a,e.lang),onUpdate:typeof e.preload=="function"?e.preload:obj_restHandler.onPreloaderUpdate,onLoaded:function(){st(!0)},additionalCounter:o,lang:e.lang,resol:d}),s=obj_restHandler.loadSoundManager({soundVersions:t.getSoundVersions(),soundFiles:i,smallSounds:y,soundFileVersion:e.soundFileVersion,onProgress:r.onExternProgress}),hype_playDrawSymbolSound=function(){s.play({playwhat:"book"})},hype_playEndOfFeatureSound=function(){s.play({soundLine:"fg1",playwhat:"choiceResult"})},hype_playMagicAnimationSound=function(){s.play({soundLine:"fg1",playwhat:"choiceStart"})}}(e)}var obj_restHandler,obj_anim,obj_console,obj_slotmachineController;