(window.webpackJsonp1551873346350=window.webpackJsonp1551873346350||[]).push([[4],{70:function(e,t,r){"use strict";r.r(t),r.d(t,"SkywindAnalytics",function(){return d});var n=r(1),i=r(17),s=r(10),o=r(0),a=r(7),c=r(5),p=r(4),u=r(2),m=r(25),h="n/a",d=function(){function e(){var e=this;this.server=Object(o.b)(i.a),this.locale=Object(o.b)(s.a),this.device=Object(o.b)(c.a),this.wrapperModel=Object(o.b)(a.a),this.gameAPIManager=Object(o.b)(m.a),this.eventDispatcher=Object(o.b)(u.a),this.brandId=this.wrapperModel.token.brandId||-1,this.playerCode=this.wrapperModel.token.playerCode||h,this.mode=this.wrapperModel.funMode?"fun":"real",this.url="",this.eventsLog=[],this.splashPromise=new Promise(function(t){e.eventDispatcher.once("SPLASH_COMPLETE",t)});var t=r(29).MenuViewMobile;this.menu=Object(o.b)(t),this.wrapperModel.getServerConfig().then(this.initialize.bind(this))}return e.prototype.initialize=function(e){var t=this;e.skywindAnalytics&&(this.url=e.skywindAnalytics,"performance"in window&&performance&&performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(300),this.eventDispatcher.on("ADD_TO_ANALYTICS",function(e){return t.eventsLog.push(e)}).on("ANALYTICS",this.onServerAnalytics,this))},e.prototype.fetch=function(e){this.url&&fetch(this.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})},e.prototype.send=function(e){var t=e[e.length-1];if(2===e.length){var r=e[0];t.options={dnsTime:r.dnsTime,sslTime:r.sslTime,tcpTime:r.tcpTime,timeToFirstByte:r.timeToFirstByte,totalTime:r.totalTime,responseTime:r.responseTime,requestDuration:r.requestDuration}}if(e.length>2){t.webSocketsTimings=[];for(var n=0;n<e.length-1;n++){r=e[n];t.webSocketsTimings.push({dnsTime:r.dnsTime,sslTime:r.sslTime,tcpTime:r.tcpTime,timeToFirstByte:r.timeToFirstByte,totalTime:r.totalTime,responseTime:r.responseTime,requestDuration:r.requestDuration})}}this.fetch(t)},e.prototype.getSpinData=function(e){for(var t=[],r=0,n=this.getServerTimings();r<n.length;r++){var i=n[r];t.push(this.parseSpinData(i,e))}return this.eventsLog=[],t},e.prototype.parseSpinData=function(e,t){var r=e.domainLookupStart,n=e.domainLookupEnd,i=e.connectStart,s=e.connectEnd,o=e.responseStart,a=e.responseEnd,c=e.requestStart,p=e.secureConnectionStart,u=t?t.error:void 0,m=this.menu.getVolume(),h={name:document.title,origin:location.origin,type:"spin",requestId:t?t.params.requestId:-1,isMobile:!0,brandId:this.brandId,gameId:this.server.getGameCode(),mode:this.mode,gameServer:this.server.getServerUrl(),playerCode:this.playerCode,gameSession:this.server.getSession().getSession(),requestDuration:t?t.time:0,dnsTime:n-r,tcpTime:s-i,sslTime:c-p,timeToFirstByte:o-c,responseTime:a-o,totalTime:a-i,errorCode:u?u.code||-1:0,sound:!!m,soundLevel:m,wrapperVersion:this.wrapperModel.version};return u&&(h.errorMessage=u.message||u),this.eventsLog.length&&(h.eventsLog=this.eventsLog),this.gameAPIManager.gameAPI&&(h.isAutoSpinsActive=this.gameAPIManager.gameAPI.isAutoSpinsActive(),h.isContinuousSpinsActive=this.gameAPIManager.gameAPI.isContinuousSpinsActive()),h},e.prototype.getInitData=function(e){for(var t=this.realScreenSize(),r=t.screenSize,i=t.viewportSize,s=this.detectWebGL(),o=s.webgl1support,a=s.maxTextureSize,c=window.performance&&performance.timing&&performance.timing.navigationStart,p={type:"init",screenSize:r,viewportSize:i,pixelRatio:devicePixelRatio,currency:this.wrapperModel.token.currency||e.params.startGameToken.currency||h,language:this.locale.getLocale(),benchmark:this.device.benchMarkScore,webgl1support:o,webgl2support:this.detectWebGL2(),es6support:this.device.isES6Support,slowConnection:this.device.isSlowConnection,maxTextureSize:a,urlParams:this.device.getParams,assetsLoadingTime:c?Date.now()-c:0,userAgent:navigator.userAgent,dpi:this.device.screenDensity,canvasMode:!this.device.isWebGLSupport,browser:this.device.getBrowser(),operatingSystem:this.device.getOS(),orientation:this.device.isLandscape?"landscape":"portrait",referrer:document.referrer||h},u=[],m=0,d=this.getSpinData(e);m<d.length;m++){var g=d[m];u.push(n.a({},g,p))}return u},e.prototype.getCanvas=function(){return document.createElement("canvas")},e.prototype.detectWebGL=function(){var e=this.getCanvas(),t=e.getContext("webgl")||e.getContext("experimental-webgl"),r=!!(t&&t instanceof WebGLRenderingContext);return{webgl1support:r,maxTextureSize:t&&r?t.getParameter(t.MAX_TEXTURE_SIZE):-1}},e.prototype.detectWebGL2=function(){var e=this.getCanvas().getContext("webgl2");return!!(e&&e instanceof window.WebGL2RenderingContext)},e.prototype.onServerAnalytics=function(e){var t=this;if(e.params)switch(e.params.request){case"spin":this.send(this.getSpinData(e));break;case"init":this.splashPromise.then(function(){t.send(t.getInitData(e))})}else this.fetch(e.error)},e.prototype.getResources=function(){var e,t,r=this.server.getServerUrl();0===this.server.mode?(e=performance.getEntriesByName(r,"resource"))&&e.length||console.warn("Error detect resource"):("function"==typeof URL?t=new URL(r):(t=document.createElement("a")).href=r,e=performance.getEntriesByType("resource").filter(function(e){return e.name.startsWith(t.origin)}));return e},e.prototype.getServerTimings=function(){var e=[{domainLookupStart:0,domainLookupEnd:0,connectStart:0,connectEnd:0,responseStart:0,responseEnd:0,requestStart:0,secureConnectionStart:0}];if(!window.performance||"function"!=typeof performance.getEntriesByName)return e;var t=this.getResources();if(!t||!t.length)return e;"function"==typeof performance.clearResourceTimings&&performance.clearResourceTimings();for(var r=[],n=0,i=t;n<i.length;n++){var s=i[n],o=s,a=o.startTime,c=o.responseEnd;r.push({domainLookupStart:s.domainLookupStart||0,domainLookupEnd:s.domainLookupEnd||0,connectStart:s.connectStart||a||0,connectEnd:s.connectEnd||c||0,responseStart:s.responseStart||a||0,responseEnd:c||0,requestStart:s.requestStart||a||0,secureConnectionStart:s.secureConnectionStart||a||0})}return r},e.prototype.realScreenSize=function(){var e=devicePixelRatio||1;return{screenSize:Object(p.g)(screen.width*e,screen.height*e),viewportSize:Object(p.g)(innerWidth*e,innerHeight*e)}},e=n.c([o.a],e)}()}}]);